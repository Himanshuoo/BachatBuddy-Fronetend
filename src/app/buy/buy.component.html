<div class="checkout-page">
  <div class="left-section">
    <!-- Step 1 -->
    <div class="card-section">
      <h3>1. LOGIN</h3>
      <div class="info-row">
        <p><strong>Hey {{ userName }}</strong>, thank you for ordering with us! üõçÔ∏è</p>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="card-section">
      <h3>2. DELIVERY ADDRESS</h3>

      <div class="address-list">
        <div *ngFor="let a of addresses; let i = index" class="address-card"
          [class.selected]="i === selectedAddressIndex" (click)="selectAddress(i)">
          <input type="radio" [checked]="i === selectedAddressIndex" />
          <div>
            <strong>{{ a.name }}</strong> ({{ a.phone }})
            <p>{{ a.line1 }}<span *ngIf="a.line2">, {{ a.line2 }}</span></p>
            <p>{{ a.city }}, {{ a.state }} - {{ a.pincode }}</p>
          </div>
        </div>
      </div>

      <button class="link-btn" (click)="addNewAddress()">
        + Add New Address
      </button>
    </div>

    <!-- Step 3 -->
    <div class="card-section" *ngIf="cartItems.length > 0">
      <h3>3. ORDER SUMMARY</h3>
      <div class="order-item" *ngFor="let item of cartItems">
        <img [src]="item.pimage" [alt]="item.pname" />
        <div class="order-info">
          <h4>{{ item.pname }}</h4>
          <p>Qty: {{ item.qty }}</p>
          <p>Price: ‚Çπ{{ item.price }}</p>
          <p class="saving" *ngIf="!isCartPurchase">You Save ‚Çπ{{ totalSavings }}</p>
        </div>
      </div>
    </div>

    <!-- Step 4 -->
    <div class="card-section">
      <h3>4. PAYMENT OPTIONS</h3>
      <div class="payment-options">
        <label>
          <input type="radio" name="payment" (click)="openPaymentDialog('UPI')"
            [checked]="selectedPaymentMode === 'UPI'" />
          UPI
          <span *ngIf="selectedPaymentMode === 'UPI' && paymentDetails">‚úÖ ({{ paymentDetails.upiId }})</span>
        </label>
        <label>
          <input type="radio" name="payment" (click)="openPaymentDialog('Card')"
            [checked]="selectedPaymentMode === 'Card'" />
          Credit/Debit Card
          <span *ngIf="selectedPaymentMode === 'Card' && paymentDetails">‚úÖ (Card Added)</span>
        </label>
        <label>
          <input type="radio" name="payment" (click)="selectedPaymentMode = 'COD'; paymentDetails = 'COD'"
            [checked]="selectedPaymentMode === 'COD'" />
          Cash on Delivery
        </label>
      </div>
      <button class="confirm-btn" (click)="confirmOrder()">Confirm Order</button>
    </div>
  </div>

  <app-payment-dialog *ngIf="showPaymentDialog" [mode]="selectedPaymentMode" (confirm)="onPaymentConfirmed($event)"
    (cancel)="cancelPaymentDialog()">
  </app-payment-dialog>

  <!-- RIGHT SIDE -->
  <div class="right-section" *ngIf="product || cartItems.length > 0">
    <div class="price-box">
      <h3>PRICE DETAILS</h3>

      <!-- Mini Item Summary -->
      <div class="mini-items-summary">
        <!-- For Cart Purchase -->
        <ng-container *ngIf="isCartPurchase">
          <div class="mini-item-row" *ngFor="let item of cartItems">
            <img [src]="item.pimage" class="mini-item-img">
            <div class="mini-item-info">
              <span class="mini-item-name">{{ item.pname }}</span>
              <span class="mini-item-qty">Qty: {{ item.qty }}</span>
            </div>
            <span class="mini-item-price fw-bold small">‚Çπ{{ item.price * item.qty }}</span>
          </div>
        </ng-container>
        <!-- For Single Purchase -->
        <div class="mini-item-row" *ngIf="!isCartPurchase && product">
          <img [src]="product.pimage" class="mini-item-img">
          <div class="mini-item-info">
            <span class="mini-item-name">{{ product.pname }}</span>
            <span class="mini-item-qty">Qty: {{ quantity }}</span>
          </div>
          <span class="mini-item-price fw-bold small">‚Çπ{{ totalPrice }}</span>
        </div>
      </div>

      <div class="price-row">
        <span>Price ({{ totalItems }} item{{ totalItems > 1 ? 's' : '' }})</span>
        <span>‚Çπ{{ totalPrice + totalSavings }}</span>
      </div>
      <div class="price-row">
        <span>Discount</span>
        <span class="green">‚àí ‚Çπ{{ totalSavings }}</span>
      </div>
      <hr />
      <div class="price-row total">
        <strong>Total Payable</strong>
        <strong>‚Çπ{{ totalPrice }}</strong>
      </div>
      <div class="savings-text">
        üéâ You saved ‚Çπ{{ totalSavings }} on this order!
      </div>
    </div>
  </div>
</div>