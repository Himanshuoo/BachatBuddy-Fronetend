<section class="group-deals">
  <div class="gifts-container">
    <div class="gifts-header">
      <h1>ðŸ”¥ Popular Grocery Deals</h1>
      <p>Join active groups to unlock wholesale prices!</p>
    </div>

    <!-- Skeleton Loader -->
    <div *ngIf="loading" class="skeleton-grid">
      <div class="skeleton-card" *ngFor="let i of [1,2,3,4]"></div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-message">
      <p>{{ error }}</p>
    </div>

    <!-- Deals Grid -->
    <div class="gifts-grid" *ngIf="!loading && !error">
      <div class="gift-card shadow-sm" *ngFor="let item of popularProducts" (click)="openDeal(item)"
        style="cursor: pointer;">
        <!-- Savings Badge (Top Right) -->
        <span class="badge-savings">Save â‚¹{{ item.originalPrice - item.groupPrice }}</span>

        <div class="card-image">
          <img [src]="item.productImage" alt="{{item.productName}}">
          <span class="category-badge">{{ item.category || 'Grocery' }}</span>
        </div>

        <div class="card-body">
          <h4>{{item.productName}}</h4>
          <p class="description">{{ item.description || 'Exclusive grocery deal with significant savings for all
            members.' }}</p>

          <div class="price-row">
            <span class="price">â‚¹{{item.groupPrice}}</span>
            <span class="original-price" *ngIf="item.originalPrice">â‚¹{{item.originalPrice}}</span>
          </div>

          <!-- Progress Section -->
          <div class="progress-section">
            <div class="progress-container">
              <div class="progress-bar-inner" [style.width.%]="item.progressPercentage"
                [ngClass]="{'high': item.progressPercentage >= 80, 'mid': item.progressPercentage >= 40}">
              </div>
            </div>
            <div class="joined-info">
              <span>ðŸ‘¥ {{item.currentJoined}}/{{item.totalNeeded}} joined</span>
              <span class="viewing-now pulse" *ngIf="item.viewingNow">ðŸ‘€ {{item.viewingNow}}</span>
            </div>
          </div>

          <div class="action-buttons">
            <button class="btn-detail" (click)="$event.stopPropagation(); openDeal(item)">View Details</button>
            <button class="btn-buy" [disabled]="item.isGroupComplete"
              (click)="$event.stopPropagation(); joinGroup(item)">
              {{ item.hasUserJoined ? 'Already Joined' : item.isGroupComplete ? 'Group Full' : 'Join Group' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>