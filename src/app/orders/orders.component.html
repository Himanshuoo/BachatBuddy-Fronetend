<div class="orders-wrapper">
  <!-- Hero Welcome Box -->
  <div class="hero-header">
    <div class="container">
      <h1>My Orders üì¶</h1>
      <p class="fs-5">Track, review, and manage your shopping history</p>
    </div>
  </div>

  <div class="container">
    <!-- Glassmorphism Search Header -->
    <div class="search-header-container mb-5">
      <div class="glass-search-card">
        <div class="d-flex align-items-center">
          <div class="search-input-wrap flex-grow-1">
            <input type="text" class="form-control" placeholder="Search by product name, ID, or city..."
              [(ngModel)]="searchTerm" (input)="filterOrders()">
            <span class="search-icon">üîç</span>
          </div>
          <button class="btn btn-ultra-search ms-3 d-none d-md-block">SEARCH</button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-grow text-primary" role="status"></div>
      <h3 class="mt-4 fw-bold">Fetching your history... üïí</h3>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="alert alert-danger shadow rounded-4 p-4 mb-4">
      <div class="d-flex align-items-center">
        <span class="fs-1 me-3">‚ö†Ô∏è</span>
        <div>
          <h5 class="fw-bold mb-1">Unable to load orders</h5>
          <p class="mb-0">{{ error }}</p>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && filteredOrders.length === 0" class="empty-hero text-center py-5">
      <img src="https://static-assets-web.flixcart.com/fk-p-linchpin-web/fk-cp-zion/img/myorders-empty_823331.png"
        alt="Empty" class="mb-4" style="width: 250px; opacity: 0.8;">
      <h2 class="fw-bold">No orders found</h2>
      <p class="text-muted fs-5 mb-4">Start shopping to see your orders here!</p>
      <a routerLink="/products" class="btn btn-start-shopping">CONTINUE SHOPPING</a>
    </div>

    <!-- Modern Interactive Orders List -->
    <div class="orders-grid mb-5" *ngIf="!loading && filteredOrders.length > 0">
      <div class="order-card-ultra shadow-sm" *ngFor="let order of filteredOrders; let i = index"
        [style.animation-delay]="i * 0.1 + 's'">
        <div class="row g-0">
          <!-- Left Side: Status & Actions -->
          <div class="col-md-3 p-4 bg-light d-flex flex-column align-items-center justify-content-center text-center">
            <div class="st-bubble mb-3" [ngClass]="{
              'pending': order.status === 'Pending',
              'delivered': order.status === 'Delivered',
              'cancelled': order.status === 'Cancelled'
            }">
              <span>{{ order.status === 'Delivered' ? '‚óè' : order.status === 'Cancelled' ? '‚óè' : '‚óè' }}</span>
              {{ order.status }}
            </div>
            <p class="text-muted small mb-1">Order Date</p>
            <h6 class="fw-bold mb-3">{{ (order.date | date:'MMM d, yyyy') || 'Recent' }}</h6>

            <div class="d-grid gap-2 w-100 px-3">
              <button class="btn btn-outline-primary btn-sm rounded-3 fw-bold py-2" (click)="reviewOrder(order)">‚≠ê
                REVIEW</button>
              <button class="btn btn-outline-danger btn-sm rounded-3 fw-bold py-2" *ngIf="order.status === 'Pending'"
                (click)="cancelOrder(order)">‚úï CANCEL</button>
            </div>
          </div>

          <!-- Mid Section: Timeline & Shipping -->
          <div class="col-md-5 p-4 d-flex flex-column justify-content-center border-md-end">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <p class="text-muted small mb-0">ORDER ID</p>
                <h5 class="fw-bold text-primary">#{{ order.id ? order.id.toString().substring(0,8).toUpperCase() : 'ORD'
                  + (i + 142) }}</h5>
              </div>
            </div>

            <!-- Interactive Visual Timeline -->
            <div class="timeline-wrap">
              <div class="timeline-line"></div>
              <div class="timeline-step active">
                <div class="step-icon"></div>
                <div class="step-label">Ordered</div>
              </div>
              <div class="timeline-step" [class.active]="order.status === 'Delivered' || order.status === 'Shipped'">
                <div class="step-icon"></div>
                <div class="step-label">Shipped</div>
              </div>
              <div class="timeline-step" [class.active]="order.status === 'Delivered'">
                <div class="step-icon"></div>
                <div class="step-label">Delivered</div>
              </div>
            </div>

            <div class="mt-4 p-3 rounded-4" style="background: rgba(0,0,0,0.02); border: 1px dashed rgba(0,0,0,0.1);">
              <p class="small text-muted mb-0">üìç Delivery to: <strong class="text-dark">{{ order.shippingAddress?.city
                  }}, {{
                  order.shippingAddress?.pincode }}</strong></p>
            </div>
          </div>

          <!-- Right Side: Price Details (Items + Totals) -->
          <div class="col-md-4 p-4 order-price-summary">
            <h6 class="fw-bold text-uppercase mb-3" style="letter-spacing: 1px; font-size: 0.75rem; color: #94a3b8;">
              Items Summary</h6>

            <div class="mini-items-scroll">
              <div class="mini-item-row" *ngFor="let item of order.items">
                <img [src]="item.pimage || item.image || 'assets/default-product.jpg'" class="mini-img"
                  [alt]="item.pname">
                <div class="mini-info">
                  <span class="mini-name">{{ item.pname || item.name || 'Product' }}</span>
                  <span class="mini-qty">Quantity: {{ item.qty || item.quantity || 1 }}</span>
                </div>
                <span class="mini-price">‚Çπ{{ item.price || 0 }}</span>
              </div>

              <!-- Fallback (legacy orders) -->
              <div class="mini-item-row" *ngIf="!order.items || order.items.length === 0">
                <img [src]="order.imageUrl || 'assets/default-product.jpg'" class="mini-img">
                <div class="mini-info">
                  <span class="mini-name">{{ order.productName }}</span>
                  <span class="mini-qty">Quantity: {{ order.quantity || 1 }}</span>
                </div>
                <span class="mini-price">‚Çπ{{ order.total }}</span>
              </div>
            </div>

            <div class="price-breakdown pt-2">
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted small">Subtotal</span>
                <span class="fw-bold small">‚Çπ{{ (order.total || 0) + (order.savings || 0) }}</span>
              </div>
              <div class="d-flex justify-content-between mb-2 text-success" *ngIf="order.savings > 0">
                <span class="small">Voucher/Group Discount</span>
                <span class="fw-bold small">- ‚Çπ{{ order.savings || 0 }}</span>
              </div>
              <hr class="my-2">
              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-bold">Amount Paid</span>
                <span class="fw-bolder fs-4 text-primary">‚Çπ{{ order.total || 0 }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>